# Quick Capture Functional Design Document

## 1. Component Overview

### 1.1 QuickCapture (Main Component)
- **Purpose**: Primary interface for creating and managing entries.
- **Key Features**:
  - Entry creation and editing
  - Prefix management
  - Entry filtering and search
  - Real-time updates

### 1.2 Subcomponents
1. **Entry Text Area**
   - Primary input for entry content: free text entry with a prefix assistant modal that launches when a prefix symbol is detected during entry
   - Prefix symbol detection (@, !, ?, #): when a user enters a prefix symbol, a prefix assistant modal launches which lists all of that user's prefixes of that type in alphabetical order.
   - Real-time content updates: submission of an entry is committed to the database, which stores both the raw entry data as well as its relationship to existing and new prefixes, and adds to the prefixes table if a new prefix is entered.
   - Keyboard shortcuts (Enter to submit)

2. **PrefixTypeFilter**
   - Type-based filtering (@people, !actions, ?ideas, #tags)
   - Radio button selection
   - State management for selected type: when a type filter is selected, no other type can be selected until the results in filteredentries are fully loaded from the database.

3. **PrefixSearch**
   - Search and select existing prefixes
   - Filter by type and value: when the user enters a prefix symbol, the list of available prefixes is displayed below this component. When no type filter is selected, this list of prefixes is the full list of prefixes for the user based on the symbol they entered. If a type filter is selected, the list of prefixes is based on the prefixes linked to the type-filtered entries (generated by the get_available_prefixes function)
   - Keyboard navigation

4. **FilteredEntries**
   - Display filtered entries: when no filter or prefix has been selected, the full list of entries for the user is displayed. when a type filter is selected, create_type_filter should be used to generate a temporary table with a subset of the user's entries that contain at least one prefix of the selected type. when both a type filter and prefix values have been selected, the list of entries in the type filtered table should be further filtered down to only entries that contain at least one of each selected prefix from prefixsearch.
   - Entry count management: this count should be regenerated and displayed whenever filteredentries is refreshed
   - Prefix tag display: prefix tags are shown in the list of displayed entries
   - Loading states

## 2. Use Cases

### 2.1 Entry Creation
1. **Basic Entry**
   - User types content
   - Presses Enter or clicks Save
   - Entry is saved with timestamp

2. **Entry with Prefixes**
   - User types prefix symbol (@, !, ?, #)
   - PrefixOverlay appears, listing all prefixes of the type associated with the symbol in alphabetical order. as the user types characters, the list is filtered down to those prefixes containing those characters.
   - User selects an existing prefix or a new prefix is created if the user entry doesn't match any existing prefix.
   - Prefix is added in bracket format [@name]

### 2.2 Entry Filtering
1. **Type Filtering**
   - "No filters" is the default type selection on app load. When "No filters" is selected and no prefixes have been selected, all results from the entries table should be displayed (the temporary table should not be used).
   - User selects prefix type
   - Temporary table created
   - Entries filtered by type
   - Available prefixes updated to include all prefixes of all types linked to entries in the temporary table
   - No other types are able to be selected until the selected type fully returns results and results are rendered in the filteredentries component
   - When a user selects another type filter, any selected prefix values should be cleared, create_type_filter should be called, the previous temporary table should be dropped, a new temporary table should be created with the newly selected type, and available prefixes should be updated based on the new temporary table
   - When a user selects "no filters", any selected prefix values should be cleared, and all entries should be retrieved directly from the entries table without any filter

2. **Prefix Value Filtering**
   - User enters prefix symbol, PrefixOverlay appears, listing all prefixes of the type associated with the symbol in alphabetical order. as the user types characters, the list is filtered down to those prefixes containing those characters. If a type filter is in place, the list of available prefixes should be those defined by the function get_available_prefixes at the time the type filter was set
   - User selects specific prefixes one at a time
   - Entries filtered by prefix values: only entries with at least one of each of the selected prefixes should be displayed
   - Results updated in real-time

### 2.3 Entry Management
1. **Viewing Entries**
   - No entries viewed by default
   - Filtered by type and/or prefix when selected
   - Sorted by creation date

2. **Updating Entries**
   - Entries can be edited with an edit buton or deleted with a delete button
   - In edit mode, the plaintext of the entry can be edited directly.
   - In edit mode, linked prefixes are shown in the entry with an "x" button. Clicking the "x" button removes the prefix tag and also removes the prefix text from the entry including the brackets and symbols
   - Changes saved on submit

## 3. Data Flow

### 3.1 State Management
```typescript
interface QuickCaptureState {
  content: string;
  selectedPrefixType: PrefixType | null;
  currentPrefix: PrefixType | null;
  selectedPrefixes: string[];
  isPrefixOverlayOpen: boolean;
  prefixSuggestions: PrefixSuggestion[];
  prefixInput: string;
  isTypeFilterLoading: boolean;
}
```

### 3.2 Data Transformations
1. **Entry Creation**
   ```
   User Input → parseEntry() → ParsedEntry → EntryService.createEntry() → Database
   ```

2. **Prefix Handling**
   ```
   Symbol Detection → PrefixOverlay → Prefix Selection → Bracket Format
   ```

3. **Filtering Flow**
   ```
   Type Selection → create_type_filter → Temporary Table → filter_by_prefixes → Filtered Results
   ```

## 4. Behavioral Specifications

### 4.1 Input/Output
1. **Entry Text Area**
   - Input: User text, prefix symbols
   - Output: Formatted entry with prefixes
   - Validation: Non-empty content

2. **Prefix Search**
   - Input: Search term, type filter
   - Output: Filtered prefix suggestions
   - Validation: Valid prefix type

### 4.2 Error Handling
1. **Entry Creation**
   - Empty content validation
   - Database errors
   - Network errors

2. **Prefix Management**
   - Invalid prefix format
   - Duplicate prefixes
   - Database errors

### 4.3 Loading States
1. **Type Filter Initialization**
   - Loading indicator
   - Disabled inputs
   - Progress feedback

2. **Entry Submission**
   - Submit button state
   - Success/error messages
   - Auto-refresh

## 5. Testing Requirements

### 5.1 Key Scenarios
1. **Entry Creation**
   - Basic entry creation
   - Entry with prefixes
   - Empty entry prevention

2. **Prefix Management**
   - Prefix symbol detection
   - Prefix selection
   - Prefix removal

3. **Filtering**
   - Type filter application
   - Prefix value filtering
   - Combined filters

### 5.2 Success/Failure Conditions
1. **Success**
   - Entry saved successfully
   - Prefixes created/selected
   - Filters applied correctly

2. **Failure**
   - Network errors
   - Invalid input
   - Database errors

### 5.3 Performance
1. **Response Time**
   - Entry submission < 1s
   - Filter application < 500ms
   - Prefix search < 200ms

2. **Resource Usage**
   - Memory efficient
   - Minimal database calls
   - Optimized re-renders 